@{
    ViewBag.Title = "ShowGrid";
}

<h2>ShowGrid</h2>
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<div class="container">

    <div style=" padding:60px ; padding-bottom:5px;">
        <h2>Search Panel</h2>
        <table>
            <tbody>
                <tr>
                    <td>
                        @Html.DropDownList("Sch", ViewBag.schools as SelectList, "اختار المدرسه", new
                        {
                            @id = "SearchSchool"@*, @class = "selectCountry show-tick form-control"*@})
                    </td>

                    <td>
                        @Html.TextBox("CreatedAt", "", new { type = "date", @class = "form-control", @id = "SearchDate" })

                
                    </td>
                    <td>
                        <input type="button" class="btn btn-light" value="Search" id="btnSearch" />
                    </td>
                    <td>
                        <input type="button" class="btn btn-light" value="Clear Filter" id="btnClear" />
                    </td>
                    <td>
                        <a class="btn btn-primary" href="/Home/Create">Add Student</a>
                    </td>




                </tr>
            </tbody>
        </table>
    </div>

    <div style="width:90%; margin:0 auto;">
        <table id="demoGrid" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                </tr>
                <tr>
                    <th>الرقم</th>
                    <th>StudentName</th>
                    <th>Percentage</th>
                    <th>SchoolName</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>

            </thead>
        </table>
        @Html.ActionLink("ExportPdf", "Pdf", new { Reporttype = "pdf" })|
        @Html.ActionLink("PrintPdf", "PrintPdf", new { Reporttype = "pdf" })

    </div>
</div>


<link href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/buttons/1.3.1/css/buttons.dataTables.min.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

@section scripts{
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script>



    <script src="https://cdn.datatables.net/buttons/1.3.1/js/dataTables.buttons.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.3.1/js/buttons.flash.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/pdfmake.min.js"></script>
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/vfs_fonts.js"></script>
    <script src="//cdn.datatables.net/buttons/1.3.1/js/buttons.html5.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.3.1/js/buttons.print.min.js"></script>





    <script>
        $(document).ready(function () {





   $("#demoGrid").DataTable({

                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "pageLength": 5,

                "ajax": {
                    "url": "/Home/LoadData",
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                        "visible": false,
                        "searchable": false
                    },
                    {
                        "targets": [2],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [3],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [4],
                        "searchable": true,
                        "orderable": true
                    }],

                "columns": [
                    { "data": "ID", "name": "ID", "autoWidth": true },
                    { "data": "StudentName", "name": "StudentName", "autoWidth": true },
                    { "data": "Percentage", "name": "Percentage", "autoWidth": true },
                    { "data": "SchoolName", "title": "SchoolName", "name": "StudentName", "autoWidth": true },
                    {
                        "render": function (data, type, full, meta)
                        { return '<a class="btn btn-info" href="/Home/Edit/' + full.ID + '">Edit</a>'; }
                    },
                    {
                        data: null, render: function (data, type, row)
                        {
                            return "<a href='#' class='btn btn-danger' onclick=DeleteData('" + row.ID + "'); >Delete</a>";
                        }

                    }

                ],
       "dom": "Bfrtip",
       "buttons": [
           {
               extend: 'copy',
               className: 'copyButton',
               text: '<i class="fa fa-clone"></i> Copy'
           },
           {
               extend: 'excel',
               text: '<i class="fa fa-file-excel-o"></i> Excel'
           },
           {
               extend: 'pdf',
               text: '<i class="fa fa-file-pdf-o"></i> Pdf'
           },
           {
               extend: 'csv',
               text: '<i class="fa fa-file-excel-o"></i> CSV'
           },
           {
               extend: 'print',
               text: '<i class="fa fa-print"></i> Print',
               customize: function (win) {
                   $(win.document.body)
                       .css('font-size', '10pt')
                       .prepend(
                           '<img src="http://datatables.net/media/images/logo-fade.png" style="position:absolute; top:0; left:0;" />'
                       );

                   $(win.document.body).find('table')
                       .addClass('compact')
                       .css('font-size', 'inherit');
               }
           },
           {
               text: 'Custom Button',
               action: function () {
                   alert('hi');
               }
           }
       ]
   });

            var oTable = $('#demoGrid').DataTable();

            $('#btnSearch').click(function () {
                oTable = $('#demoGrid').DataTable();
                oTable.columns(1).search($("input[type='search']").val().trim());
                oTable.draw();
            });

            $('#btnClear').click(function () {
                $('#SearchSchool').val("");
                $("input[type='search']").val("");
                $("[name='demoGrid_length']").val("");
                //$("input[type='search']").attr('value', "");
            });

            $('#SearchSchool').change(function () {
                oTable.columns(1).search($('#SearchSchool').val().trim());
                oTable.draw();
            });


            $('#SearchDate').change(function () {
                oTable.columns(1).search($('#SearchDate').val().trim());
                oTable.draw();
            });

            $('#SearchSchool').chosen();


        });


        function DeleteData(StudentID) {
            if (confirm("Are you sure you want to delete ...?")) {
                Delete(StudentID);
            }
            else {
                return false;
            }
        }


        function Delete(StudentID) {
            var url = '@Url.Content("~/")' + "Home/DeleteStudent";
            $.post(url, { ID: StudentID }, function (data) {
                if (data == "Deleted") {
                alert("Delete Student !");
                oTable = $('#demoGrid').DataTable();
                oTable.draw();
            }
            else {
                alert("Something Went Wrong!");
            }
        });
        }


    </script>


}
